---
title: "Indoor logs cleaning"
author: "Media Innovation Group"
---

This data is the record indoor temperatures at each unit from April to September. This information was acquired by Lauren McGaughy at KUT through a public information request to the Texas Department of Criminal Justice.

The original PDFs were transcribed into data using Google Pinpoint, resulting in the csv files found in `data-raw`. The original documents are found in `data-original`.

## Goals of this notebook

What we'll do to prepare the data:

- Download the data
- Import it into our notebook
- Clean up data types and columns 
- Export data into our next notebook

## Setup

```{r}
#| label: setup
#| message: false

library(tidyverse)
library(janitor)
```

## Downloading data

This data comes from a public information request to the Texas Department of Criminal Justice. We have two seperate sheets with our 30-day months and our 31-day months, so we'll read each of those in separately.

```{r}
indoor_temps <- read_csv("data-raw/Indoor-30days-edited.csv")

indoor_temps |> glimpse()
```

```{r}
other_indoor_temps <- read_csv("data-raw/Indoor-31days-edited.csv")

other_indoor_temps |> glimpse()
```

## Pivot Longer

Right now each day is a column, let's change it so days are all under one column and clean up the names of our columns.

We'll do this individually before we join the columns so we don't have to remove the 31st rows for months with only 30 days.

```{r}
other_temps_raw <- other_indoor_temps |> 
  pivot_longer(
    cols = "1":"31",
    names_to = "day",
    values_to = "temperature"
  )

other_temps_raw
```

```{r}
indoor_temps_raw <- indoor_temps |> 
  pivot_longer(
    cols = "1":"30",
    names_to = "day",
    values_to = "temperature"
  )

indoor_temps_raw
```

## Combine data frames

Let's combine both of our datasets to make a single table.

```{r}
indoor_temps_combined <- bind_rows(other_temps_raw, indoor_temps_raw)

indoor_temps_combined
```

## Clean names

One column we'll have to convert is our file_name column into a month/year column. In order to do that, we first have to create a value with all of the characters we want to remove.

```{r}
word_list <- c("SB1R56 - |_1.pdf|_2.pdf")
```

Now that we've done that, let's clean names and make our new column.

```{r}
daily_indoor <- indoor_temps_combined|> 
  clean_names() |> 
  mutate(
    month_year = str_remove_all(file_name, word_list) 
  ) 

daily_indoor
```

## Add date column

We'll need to clean up the dates so they're standardized and readable. We'll combine our month/year column with the day column to put through the lubridate function and, while we're at it, remove unnecessary columns.

```{r}
daily_indoor_dated <- daily_indoor |> 
    distinct() |> 
    unite(
    col = "temp_date", 
    day, month_year,
    sep = " "
    ) |> 
  mutate(
    date = dmy(temp_date)
  ) |> 
  select(!c(file_name, validation_link, temp_date)) |> 
  mutate(unit_temp = temperature) |> 
  select(!temperature) 


daily_indoor_dated |> glimpse()
```

## Clean some unit names

It looks like the Ramsey unit was recorded with slightly different names in each csv. Let's combine both of those columns so all of the data is together and then remove any leftover NA's.

Mcconnell	183			
O’Daniel	91			
Wainwright	183	

```{r}
daily_indoor_named <- daily_indoor_dated |> 
  mutate(
    unit = case_match(
      unit,
      "Mcconnell" ~ "McConnell",
      "O’Daniel" ~ "O'Daniel",
      .default = unit
    )
  )
```

We don't have recordings for every unit. These are the units we do not have readings for: Baten, Bell, Bridgeport, Coleman, Cotulla, Diboll, Duncan, East Texas, Estes, Fort Stockton, Garza East, Glossbrenner, Halbert, Hamilton, Havins, Henley, Hodge, Hospital Galveston, Kegans, Kyle, LeBlanc, Lindsey, Marlin, Mechler, Moore, B., Ney, Pack, San Saba, Sayle, Scott, Skyview, Travis, Willacy.

## Export the data

We did it! Now let's export our data and place it in our processed data folder.

```{r}
daily_indoor_named |> write_rds("data-processed/01-indoor-cleaned.rds")
```

