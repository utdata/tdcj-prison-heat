---
title: "2025 indoor logs cleaning"
author: "Media Innovation Group"
format: html
---

This data is the recorded indoor temperatures at each unit from April to July 25. This information was acquired by Lauren McGaughy at KUT through a public information request to the Texas Department of Criminal Justice.

The original PDFs were converted into xlsx files and downloaded as csv files using Adobe Acrobat, resulting in the csv files found in 'data-original' as 'SB1R56 - April 2025(Table 1).csv' and so on for each month. The original documents are found in 'data-original/2025_indoor'. 

## Goals of this notebook

Clean and combine the 2025 indoor logs for April, May, June and July. 

## Setup

```{r}
#| label: setup
#| message: false

library(tidyverse)
library(janitor)
library(lubridate)
```

## Downloading data

This data comes from a public information request to the Texas Department of Criminal Justice. We have a separate csv file for each month from April to July, so we will import each in individually and clean names. 

```{r}
indoor_temps_april <- read_csv("data-original/SB1R56 - April 2025(Table 1).csv") |> 
  clean_names()
 
```
```{r}
indoor_temps_may <- read_csv("data-original/SB1R56 - May 2025(Table 1) (1).csv") |> 
  clean_names()
```
```{r}
indoor_temps_june <- read_csv("data-original/SB1R56 - June 2025(Table 1).csv") |> 
  clean_names()
```

```{r}
indoor_temps_july <- read_csv("data-original/SB1R56 - July 2025(Table 1).csv") |> 
  clean_names()
```

## April

## Cleaning up uneccessary rows and columns

```{r}
april_filtered <- indoor_temps_april |> filter(!april_2025 == "April 2025") |> 
  select(
    april_2025,
    x1 = x2,
    x2 = x3,
    x3 = x4,
    x4 = x5,
    x5 = x6,
    x6 = x7,
    x7 = x8,
    x8 = x9,
    x9 = x10,
    x10 = x11,
    x11 = x12,
    x12 = x13,
    x13 = x14,
    x14 = x15,
    x15 = x16,
    x16 = x17,
    x17 = x18,
    x18 = x19,
    x19 = x20,
    x20 = x21,
    x21 = x22,
    x22 = x23,
    x23 = x24,
    x24 = x25,
    x25 = x26,
    x26 = x27,
    x27 = x28,
    x28 = x29,
    x29 = x30,
    x30 = x31
  )
```

## Pivoting longer

Using pivot_longer to create a day column.

```{r}
april_pivoted <- april_filtered |> pivot_longer(
  cols = x1:x30,
  names_to = "day",
  values_to = "temperature"
  )

april_pivoted
```

## Removing 'x' from rows in the day column

Using mutate and str_remove_all to create a new day column and remove the x in front of each day.

```{r}
april_day <- april_pivoted |> mutate(day = str_remove_all(day, "x"))
```

## Creating a new column with the month and day 

Using mutate to create a new column and fill it with the month and year and rename the april_2025 column to "unit"

```{r}
april_month_year <- april_day |> mutate(
  month_year = "April 2025",
  unit = april_2025) |> select(
    !april_2025
  )
```


## Creating a real date column

Combining the month/year column with the day column, using lubridate to create a real date column and dropping the temp_date column.

```{r}
april_date <- april_month_year |> 
    # distinct() |>
    unite(
    col = "temp_date", 
    day, month_year,
    sep = " "
    ) |> mutate(
    date = dmy(temp_date)
    ) |> select(
  !temp_date
)
```

## Reordering the columns

Using reorder() to order the columns by unit, date and temp

```{r}
april_clean <- april_date |> relocate(unit, date,temperature)
```

Repeating for all other months below.

## May

## Cleaning up uneccessary rows and columns

```{r}
may_filtered <- indoor_temps_may |> filter(!may_2025 == "May 2025") |> 
  select(
    may_2025,
    x1 = x2,
    x2 = x3,
    x3 = x4,
    x4 = x5,
    x5 = x6,
    x6 = x7,
    x7 = x8,
    x8 = x9,
    x9 = x10,
    x10 = x11,
    x11 = x12,
    x12 = x13,
    x13 = x14,
    x14 = x15,
    x15 = x16,
    x16 = x17,
    x17 = x18,
    x18 = x19,
    x19 = x20,
    x20 = x21,
    x21 = x22,
    x22 = x23,
    x23 = x24,
    x24 = x25,
    x25 = x26,
    x26 = x27,
    x27 = x28,
    x28 = x29,
    x29 = x30,
    x30 = x31,
    x31 = x32
  )
```

## Pivoting longer

Using pivot_longer to create a day column.

```{r}
may_pivoted <- may_filtered |> pivot_longer(
  cols = x1:x31,
  names_to = "day",
  values_to = "temperature"
  )
```

## Removing x from rows on the day column

Using mutate and str_remove_all to create a new day column and remove the x in front of each day.

```{r}
may_day <- may_pivoted |> mutate(day = str_remove_all(day, "x"))

```

## Creating a new column with the month and day 

Using mutate to create a new column and fill it with the month and year and rename the april_2025 column to "unit"

```{r}
may_month_year <- may_day |> mutate(
  month_year = "May 2025",
  unit = may_2025) |> select(
    !may_2025
  )
```

## Creating a real date column

Combining the month/year column with the day column, using lubridate to create a real date column and dropping the temp_date column.

```{r}
may_date <- may_month_year |> 
    # distinct() |>
    unite(
    col = "temp_date", 
    day, month_year,
    sep = " "
    ) |> mutate(
    date = dmy(temp_date)
    ) |> select(
  !temp_date
)

may_date
```

## Reordering the columns

Using reorder() to order the columns by unit, date and temp.

```{r}
may_clean <- may_date |> relocate(unit, date,temperature)
```

## June

## Cleaning up uneccessary rows and columns

```{r}
june_filtered <- indoor_temps_june |> filter(!june_2025 == "June 2025") |> 
  select(
    june_2025,
    x1 = x2,
    x2 = x3,
    x3 = x4,
    x4 = x5,
    x5 = x6,
    x6 = x7,
    x7 = x8,
    x8 = x9,
    x9 = x10,
    x10 = x11,
    x11 = x12,
    x12 = x13,
    x13 = x14,
    x14 = x15,
    x15 = x16,
    x16 = x17,
    x17 = x18,
    x18 = x19,
    x19 = x20,
    x20 = x21,
    x21 = x22,
    x22 = x23,
    x23 = x24,
    x24 = x25,
    x25 = x26,
    x26 = x27,
    x27 = x28,
    x28 = x29,
    x29 = x30,
    x30 = x31
  )

```

## Pivoting longer

Using pivot_longer to create a day column.
**Important note: we manually removed an extra space from Bartlett:8 in the original June 2025 csv because it was causing the column to read as characters instead of doubles.

```{r}
june_pivoted <- june_filtered |> pivot_longer(
  cols = x1:x30,
  names_to = "day",
  values_to = "temperature"
  )
june_pivoted
```

## Removing x from rows on the day column

Using mutate and str_remove_all to create a new day column and remove the x in front of each day.

```{r}
june_day <- june_pivoted |> mutate(day = str_remove_all(day, "x"))

```

## Creating a new column with the month and day 

Using mutate to create a new column and fill it with the month and year and rename the june_2025 column to "unit"

```{r}
june_month_year <- june_day |> mutate(
  month_year = "June 2025",
  unit = june_2025) |> select(
    !june_2025
  )
```

## Creating a real date column

Combining the month/year column with the day column, using lubridate to create a real date column and dropping the temp_date column.

```{r}
june_date <- june_month_year |> 
    # distinct() |>
    unite(
    col = "temp_date", 
    day, month_year,
    sep = " "
    ) |> mutate(
    date = dmy(temp_date)
    ) |> select(
  !temp_date
)

june_date
```

## Reordering the columns

Using reorder() to order the columns by unit, date and temp.

```{r}
june_clean <- june_date |> relocate(unit, date,temperature)

june_clean
```


## July

** Because of when this public information request was filled, we only have data through July 25, 2025. Thus, all units will show "NA" for temperature between July 26 and July 31, 2025. 

## ## Cleaning up uneccessary rows and columns

```{r}
july_filtered <- indoor_temps_july |> filter(!july_2025 == "July 2025") |> 
  select(
    july_2025,
    x1 = x2,
    x2 = x3,
    x3 = x4,
    x4 = x5,
    x5 = x6,
    x6 = x7,
    x7 = x8,
    x8 = x9,
    x9 = x10,
    x10 = x11,
    x11 = x12,
    x12 = x13,
    x13 = x14,
    x14 = x15,
    x15 = x16,
    x16 = x17,
    x17 = x18,
    x18 = x19,
    x19 = x20,
    x20 = x21,
    x21 = x22,
    x22 = x23,
    x23 = x24,
    x24 = x25,
    x25 = x26,
    x26 = x27,
    x27 = x28,
    x28 = x29,
    x29 = x30,
    x30 = x31,
    x31 = x32
  ) 
```

## Pivoting longer

Using pivot_longer to create a day column

```{r}
july_pivoted <- july_filtered |> pivot_longer(
  cols = x1:x31,
  names_to = "day",
  values_to = "temperature"
  )
```

## Removing x from rows on the day column

Using mutate and str_remove_all to create a new day column and remove the x in front of each day.

```{r}
july_day <- july_pivoted |> mutate(day = str_remove_all(day, "x"))

```

## Creating a new column with the month and day 

Using mutate to create a new column and fill it with the month and year and rename the july_2025 column to "unit"

```{r}
july_month_year <- july_day |> mutate(
  month_year = "July 2025",
  unit = july_2025) |> select(
    !july_2025
  )
```

## Creating a real date column

Combining the month/year column with the day column, using lubridate to create a real date column and dropping the temp_date column.

```{r}
july_date <- july_month_year |> 
    # distinct() |>
    unite(
    col = "temp_date", 
    day, month_year,
    sep = " "
    ) |> mutate(
    date = dmy(temp_date)
    ) |> select(
  !temp_date
)
```

## Reorder the columns

Using reorder() to order the columns by unit, date and temp.

```{r}
july_clean <- july_date |> relocate(unit, date,temperature)

july_clean
```

## Combining each month into one data frame

```{r}
indoor_temps_combined <- bind_rows(april_clean, may_clean, june_clean, july_clean)

indoor_temps_combined
```

## Check dates

```{r}
 indoor_temps_combined |> 
  filter(date == "2025-06-08")
```

## Export the data

```{r}
indoor_temps_combined |> write_rds("data-processed/01-indoor-2025-cleaned.rds")
```



